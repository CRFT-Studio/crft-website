---
export const prerender = false;

import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";

import Stripe from "stripe";
const stripe = new Stripe(import.meta.env.STRIPE_API);
const checkoutSession = await stripe.checkout.sessions.create({
    line_items: [
        {
            price_data: {
                currency: "usd",
                product_data: {
                    name: "T-shirt",
                },
                unit_amount: 2000,
            },
            quantity: 2,
        },
    ],
    mode: "payment",
    ui_mode: "embedded",
    return_url:
        "https://crft-website.pages.dev/thank-you?session_id={CHECKOUT_SESSION_ID}",
});
---

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content="Astro description" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>Checkout</title>
    </head>
    <body>
        <Navigation />
        <section class="my-16">
            <div class="container">
                <div
                    id="checkout"
                    class="border-[1px] border-neutral-700 rounded-xl p-5 bg-[#1c1c1c]"
                >
                </div>
            </div>
        </section>
        <Footer />

        <span id="clientSecret" hidden>{checkoutSession.client_secret}</span>
        <script>
            import $ from "jquery";
            import { loadStripe } from "@stripe/stripe-js";
            const stripe = await loadStripe(import.meta.env.PUBLIC_STRIPE_API);
            const clientSecret = $("#clientSecret").text();
            const checkout = await stripe.initEmbeddedCheckout({
                clientSecret,
            });
            checkout.mount("#checkout");
        </script>
    </body>
</html>
